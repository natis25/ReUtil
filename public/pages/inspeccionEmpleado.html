<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Inspección del Empleado</title>
    <link rel="stylesheet" href="../static/style.css">
</head>

<body>
    <form id="formInspeccionEmpleado">
        <h1>Formulario de Inspección del Empleado</h1>

        <!-- Reciclaje/Venta -->
        <label>Destino del Dispositivo:</label>
        <div style="display: flex; gap: 2rem; align-items: center;">
            <label style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="radio" id="reciclaje_si" name="reciclaje" value="1" checked>
                Para Reciclar
            </label>

            <label style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="radio" id="reciclaje_no" name="reciclaje" value="0">
                Para Vender
            </label>
        </div>
        <br><br>

        <!-- Monto final -->
        <label for="monto_final">Monto final:</label>
        <input type="number" id="monto_final" name="monto_final" min="0" step="0.01" required>
        <br><br>

        <!-- Fecha de inspección -->
        <label for="fecha_inspeccion">Fecha de inspección:</label>
        <input type="date" id="fecha_inspeccion" name="fecha_inspeccion" required>
        <br><br>

        <!-- Botón de envío -->
        <button id="inspeccionEmpleado" type="submit">Enviar</button>
    </form>

    <div id="resultado"></div>

    <script>
        // Validación de fecha para asegurarse de que no se pueda seleccionar una fecha pasada
        document.getElementById('fecha_inspeccion').setAttribute('min', new Date().toISOString().split('T')[0]);
        // Función para validar que la fecha de inspección no sea en el pasado
        function validarFechaInspeccion() {
            const fechaInspeccion = document.getElementById('fecha_inspeccion').value;
            const fechaActual = new Date().toISOString().split('T')[0]; // Obtener la fecha actual en formato YYYY-MM-DD
            if (fechaInspeccion < fechaActual) {
                alert("La fecha de inspección no puede ser en el pasado.");
                return false;
            }
            return true;
        }

        // Función para validar el monto final
        function validarMontoFinal() {
            const montoFinal = parseFloat(document.getElementById('monto_final').value);
            if (isNaN(montoFinal) || montoFinal <= 0) {
                alert("El monto final debe ser un número positivo.");
                return false;
            }
            return true;
        }

        // Función para manejar la validación del formulario antes de enviarlo
        document.getElementById('formInspeccionEmpleado').addEventListener('submit', async function (e) {
            e.preventDefault();

            // Validar campos de reciclaje, monto final y fecha de inspección
            if (!validarFechaInspeccion()) return;
            if (!validarMontoFinal()) return;

            // Verificar que todos los campos requeridos estén presentes
            const formData = new FormData(this);
            const reciclaje = formData.get('reciclaje');
            const montoFinal = formData.get('monto_final');
            const fechaInspeccion = formData.get('fecha_inspeccion');

            console.log('Reciclaje:', reciclaje);
            console.log('Monto Final:', montoFinal);
            console.log('Fecha Inspección:', fechaInspeccion);

            if (!reciclaje || !montoFinal || !fechaInspeccion) {
                alert('Por favor, complete todos los campos requeridos.');
                return;
            }

            try {
                // Mostrar datos que se enviarán (para debug)
                console.log('Datos a enviar:', Object.fromEntries(formData));

                const response = await fetch('../../services/inspeccion/api/guardarEmpleado.php', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                console.log('Respuesta del servidor:', result);

                if (result.ok) {
                    alert('Datos guardados correctamente');
                    // Opcional: Resetear el formulario
                    this.reset();
                } else {
                    alert(`Error: ${result.error || 'No se pudo guardar'}`);
                }
            } catch (error) {
                console.error('Error en el envío:', error);
                alert('Error de conexión con el servidor');
            }
        });


    </script>

</body>

</html>